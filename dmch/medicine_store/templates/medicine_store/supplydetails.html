{% extends 'counter/base.html' %} {% block css %}
<style>
  .table td,
  .table th {
    padding: 0.25rem;
    vertical-align: top;
    font-size: 0.75rem;
    border-top: 1px solid #e3e6f0;
  }
</style>
<!-- Include DataTables CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css" />
<!-- CSS for Select2 -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
{% endblock %} {% block content %}
<!-- Begin Page Content -->
<div class="container-fluid">
  {% if messages %} {% for message in messages %}
  <p {% if message.tags %} class="{{ message.tags }}" {% endif %} style="width: 90%; font-size: 1rem">{{ message }}</p>
  {% endfor %} {% endif %}
  <div style="display: flex"></div>
  <!-- DataTales Example -->
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <form id="filterForm" style="display: flex; flex-wrap: wrap; gap: 10px">
        <div style="flex: 1">
          <input type="date" id="start_date" class="form-control mb-2 mb-md-0" name="start_date" />
        </div>
        <div style="">
          <span>-</span>
        </div>
        <div style="flex: 1">
          <input type="date" id="end_date" class="form-control mb-2 mb-md-0" name="end_date" />
        </div>
        <div style="flex: 2">
          <input type="search" class="form-control mb-2 mb-md-0" id="searchInput" placeholder="Search for names or medicines.." />
        </div>
        <div style="flex: 1">
          <button class="btn btn-primary w-100" type="submit">Filter</button>
        </div>
        <div style="flex: 1">
          <a href="{% url 'supply_details_user_view_print' %}" class="btn btn-primary w-100">Print</a>
        </div>
        <div style="flex: 3">
          <button class="btn btn-primary w-100" id="exportButton">Export to Excel</button>
        </div>
      </form>
    </div>
    <div class="card-body" id="printablecontent">
      <div class="table-responsive" id="tableContainer">
        <table class="table table-bordered" id="dataTablee" width="100%" cellspacing="0">
          <thead>
            <tr>
              <th>Reg No.</th>
              <th>Patient</th>
              <th>Medicine Name</th>
              <th>Mfg By</th>
              <th>Batch No</th>
              <th>Mfg Date</th>
              <th>Exp Date</th>
              <th>Quantity</th>
              <th>Supply Time</th>
              <th>Created On Date/Time</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block script %}
<!-- JavaScript for Select2 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<!-- Include DataTables JS -->
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
<!-- Include DataTables Buttons JS -->
<script src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.flash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.print.min.js"></script>

<script>
  $(document).ready(function () {
    $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
      var searchValue = $("#searchInput").val().toLowerCase();
      if (!searchValue) {
        return true; // If no search value, show all data
      }

      // Check if any column data starts with the search value
      for (var i = 0; i < data.length; i++) {
        if (data[i].toLowerCase().startsWith(searchValue)) {
          return true;
        }
      }
      return false;
    });

    var table = $("#dataTablee").DataTable({
      processing: true,
      serverSide: true,
      ajax: {
        url: "{% url 'supply_details_user_view_data' %}",
        data: function (d) {
          d.searchValue = $("#searchInput").val();
          d.start_date = $("#start_date").val();
          d.end_date = $("#end_date").val();
        },
      },
      columns: [{ data: "reg_no" }, { data: "patient" }, { data: "medicine_name" }, { data: "mfg_by" }, { data: "batch" }, { data: "mfg_date" }, { data: "exp_date" }, { data: "quantity" }, { data: "supply_time" }, { data: "created_on" }, { data: "actions", orderable: false }],
      paging: true, // Enable pagination
      searching: true, // Enable search feature
      lengthChange: false, // Disable page length change
      dom: "Bfrtip", // Position of the feature elements
      buttons: [
        "copy",
        {
          extend: "excelHtml5",
          text: "Export to Excel",
          className: "btn btn-primary",
          title: "Data export",
          exportOptions: {
            columns: ":visible",
          },
        },
        "pdf",
        "print",
      ],
    });

    $("#searchInput").on("keyup", function () {
      table.draw();
    });

    $("#filterForm").on("submit", function (e) {
      e.preventDefault();
      table.draw();
    });

    $("#product_name").select2();
  });
</script>

<script>
  function printTable() {
    var printContents = $("#printablecontent").html();
    var originalContents = $("body").html();
    $("body").empty().html(printContents);
    window.print();
    $("body").html(originalContents);
  }
</script>
{% endblock %}
