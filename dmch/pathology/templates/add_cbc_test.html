{% extends 'counter/base.html' %} {% block css %} {% endblock %} {% block content %}
<!-- Begin Page Content -->
<style>
  label {
    width: 230px;
  }
  .form-group {
    margin-bottom: 0.2rem;
    line-height: 0.5rem;
    align-items: center;
  }
  .form-control {
    padding: ".15rem .75rem";
  }
</style>
<div class="container-fluid">
  <!-- Page Heading -->
  {% if messages %} {% for message in messages %}
  <p {% if message.tags %} class="{{ message.tags }}" {% endif %} style="width: 90%; font-size: 1rem">{{ message }}</p>

  {% endfor %} {% endif %}
  <form id="patientForm" method="POST" action="{% url 'create_cbc_test' %}">
    {% csrf_token %}

    <div class="row">
      <!-- Left Column (Patient Details) -->
      <div class="col-md-4 mb-3">
        <label for="bill_no">Bill No.:</label>
        <input type="text" class="form-control" id="bill_no" value="" name="bill_no" required />
      </div>

      <div class="col-md-4 mb-3">
        <label for="regid">Reg No.:</label>
        <input type="text" class="form-control" id="regid" name="regid" disabled required />
      </div>

      <div class="col-md-4 mb-3">
        <label for="labno">Lab No :</label>
        <input type="text" id="labno" class="form-control" disabled name="labno" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="patient_name">Patient Name :</label>
        <input type="text" class="form-control" id="patient_name" name="patient_name" disabled required />
      </div>

      <div class="col-md-4 mb-3">
        <label for="department">Department:</label>
        <input type="text" class="form-control" id="department" value="" name="department" disabled />
      </div>

      <div class="col-md-4 mb-3">
        <label for="doctor">Refer By :</label>
        <!-- <select type="text" id="doctor" class="form-control" name="doctor" >
            <option>Select Doctor</option>
            </select> -->
        <input type="text" class="form-control" id="doctor" value="" name="doctor" disabled />
      </div>

      <div class="col-md-4 mb-3">
        <label for="wbc">WBC:</label>
        <input type="text" class="form-control" id="wbc" value="" name="wbc" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="neut">Neu% :</label>
        <input type="text" class="form-control" id="neut" value="" name="neut" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="lymph">Lym%:</label>
        <input type="text" class="form-control" id="lymph" value="" name="lymph" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="mono">Mon% :</label>
        <input type="text" class="form-control" id="mono" value="" name="mono" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="eo">Eos%:</label>
        <input type="text" class="form-control" id="eo" value="" name="eo" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="baso">Bas%:</label>
        <input type="text" class="form-control" id="baso" value="" name="baso" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="rbc">RBC:</label>
        <input type="text" class="form-control" id="rbc" value="" name="rbc" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="hgb">HGB :</label>
        <input type="text" class="form-control" id="hgb" value="" name="hgb" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="hct">HCT:</label>
        <input type="text" class="form-control" id="hct" value="" name="hct" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="mcv">MCV:</label>
        <input type="text" class="form-control" id="mcv" value="" name="mcv" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="mch">MCH:</label>
        <input type="text" class="form-control" id="mch" value="" name="mch" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="mchc">MCHC:</label>
        <input type="text" class="form-control" id="mchc" value="" name="mchc" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="rdw_cv">Rdw Cv:</label>
        <input type="text" class="form-control" id="rdw_cv" value="" name="rdw_cv" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="rdw_sd">Rdw Sd:</label>
        <input type="text" class="form-control" id="rdw_sd" value="" name="rdw_sd" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="plt">PLT:</label>
        <input type="text" class="form-control" id="plt" value="" name="plt" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="mpv">MPV:</label>
        <input type="text" class="form-control" id="mpv" value="" name="mpv" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="pdw">PDW SD:</label>
        <input type="text" class="form-control" id="pdw" value="" name="pdw" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="ret">PDW CV:</label>
        <input type="text" class="form-control" id="ret" value="" name="ret" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="pct">PCT:</label>
        <input type="text" class="form-control" id="pct" value="" name="pct" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="p_lcr">P-LCR:</label>
        <input type="text" class="form-control" id="p_lcr" value="" name="p_lcr" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="lfr">P-LCC:</label>
        <input type="text" class="form-control" id="lfr" value="" name="lfr" />
      </div>

      <div class="col-md-4 mb-3">
        <label for="dr">Doctor Signature :</label>
        <select type="text" id="dr" class="form-control" name="dr">
          <option value="">Select Doctor</option>
          <option value="santoshkumar">Dr. Santosh Kumar Sharma</option>
          <option value="knyadav">Dr. K. N. Yadav</option>
        </select>
      </div>

      <!-- 
      <div class="col-md-4 mb-3">
        <label for="irf">IRF:</label>
        <input type="text" class="form-control" id="irf" value="" name="irf" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="lfr">LFR:</label>
        <input type="text" class="form-control" id="lfr" value="" name="lfr" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="mfr">MFR:</label>
        <input type="text" class="form-control" id="mfr" value="" name="mfr" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="hfr">HFR:</label>
        <input type="text" class="form-control" id="hfr" value="" name="hfr" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="wbc_ip_message">WBC IP Message:</label>
        <input type="text" class="form-control" id="wbc_ip_message" value="" name="wbc_ip_message" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="rcb_rft_ip_message">RCB RFT IP Message:</label>
        <input type="text" class="form-control" id="rcb_rft_ip_message" value="" name="rcb_rft_ip_message" />
      </div>
      <div class="col-md-4 mb-3">
        <label for="plt_ip_message">PLT IP Message:</label>
        <input type="text" class="form-control" id="plt_ip_message" value="" name="plt_ip_message" />
      </div> -->
    </div>

    <button type="submit" class="btn btn-primary">Save</button>
  </form>
</div>

<!-- End of Main Content -->
{% endblock %} {% block script %}
<script>
  $(document).ready(function () {
    $("#bill_no").on("keypress", function (e) {
      if (e.which === 13) {
        var regid = $(this).val();
        e.preventDefault();
        if (regid) {
          $.ajax({
            url: '{% url "fetch_patient_data_details" %}',
            type: "GET",
            data: {
              regid: regid,
            },
            success: function (data) {
              console.log(data);
              // Update input fields with fetched data
              $("#patient_name").val(data.name);
              $("#regid").val(data.regid);
              $("#bill_no").val(data.bill_no);
              $("#labno").val(data.lab_no);
              $("#department").val(data.department);
              $("#doctor").val(data.referby);
              $("#patient_name").val(data.name);
              if (data.cbc_report && data.cbc_report.available) {
                // Redirect to another page
                window.location.href = `/pathology/update_cbc_test/${data.cbc_report.id}/`;
              }
            },
            error: function (xhr, status, error) {
              console.error(xhr.responseText);
              // Handle error if necessary
              $("#patient_name").val("");
              $("#regid").val("");
              $("#bill_no").val("");
              $("#labno").val("");
              $("#department").val("");
              $("#doctor").val("");
              $("#patient_name").val("");
            },
          });
        } else {
          // Clear input fields when regid is empty
          $("#patient_name").val("");
          $("#bill_no").val("");
          $("#regid").val("");
          $("#labno").val("");
          $("#department").val("");
          $("#doctor").val("");
          $("#patient_name").val("");
        }
      }
    });
  });
</script>
{% endblock %}
