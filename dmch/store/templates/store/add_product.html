{% extends 'counter/base.html' %} {% block css %} {% endblock %} {% block content %}
<!-- Begin Page Content -->
<style>
  label {
    width: 230px;
  }
  .form-group {
    margin-bottom: 0.2rem;
    line-height: 0.5rem;
    align-items: center;
  }
  .form-control {
    /* padding: 0; */
    /* font-size: 12px; */
  }
  .exp_date{
    padding: 0 !important;
    max-width: 14% !important;
  }
  .quantity_div{
    padding: 0 !important;
  }
  .cross_div{
    padding: 0 !important;
    max-width: 25px !important;
  }
</style>
<div class="container-fluid">
  <!-- Page Heading -->
  {% if messages %} {% for message in messages %}
  <p {% if message.tags %} class="{{ message.tags }}" {% endif %} style="width: 90%; font-size: 1rem">{{ message }}</p>

  {% endfor %} {% endif %}
  <form id="orderForm" method="POST" action="{% url 'product_add_view' %}">
    {% csrf_token %}
    <div class="row">
      <!-- Left Column (Patient Details) -->
      <div class="col-md-3 mb-3">
        <div class="form-group">
          <label for="department">Department:</label>
          <input type="text" class="form-control" value="{{request.session.user_role}}" disabled />
        </div>
      </div>

        <!-- Left Column (Patient Details) -->
        <div class="col-md-3 mb-3">
          <div class="form-group">
            <label for="bill_no">Bill No.:</label>
            <input type="text" class="form-control" name="bill_no" />
          </div>
        </div>
      <!-- Right Column (Order Details) -->
      <div class="col-md-3 mb-3">
        <div class="form-group">
          <label for="bill_date">Bill Date:</label>
          <input type="date" class="form-control" name="bill_date"   />
        </div>
      </div>

      <!-- Left Column (Patient Details) -->
      <div class="col-md-3 mb-3">
        <div class="form-group">
          <label for="chalan_no">Chalan No.:</label>
          <input type="text" class="form-control" name="chalan_no"  />
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="form-group">
          <label for="chalan_date">Chalan Date:</label>
          <input type="date" class="form-control" name="chalan_date"   />
        </div>
      </div>

      <div class="col-md-3 mb-3">
        <div class="form-group">
          <label for="sp_order_no">Suppritendent Order No.:</label>
          <input type="text" class="form-control" name="sp_order_no"  />
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="form-group">
          <label for="sp_order_date">Suppritendent Order Date:</label>
          <input type="date" class="form-control" name="sp_order_date"   />
        </div>
      </div>
      <div class="col-md-3 mb-3 ">
        <div class="form-group">
          <label for="received_date">Received Date:</label>
          <input type="date" class="form-control" name="received_date" value="{% if request.session.received_date %}{{request.session.received_date}}{% endif %}"  />
        </div>
      </div>
      <div class="col-md-3 mb-3 ">
        <div class="form-group">
          <label for="date">Date:</label>
          <input type="date" class="form-control" name="date" value="{% if request.session.add_product_date %}{{request.session.add_product_date}}{% endif %}"  />
        </div>
      </div>
    </div>

    <h3>Products</h3>
    <div id="productFields">
      <div class="row product-row">
        <!-- Middle Column (Product Details) -->

         
        <div class="col-md-4 mb-3">
            <div class="form-group">
              <label for="product_name_1">Product Name:</label>
              <input type="text" class="form-control" name="product_name_1"  />
            </div>
          </div>
  

          
        <div class="col-md-4 mb-3">
          <div class="form-group">
            <label for="company_name_1">Company Name:</label>
            <input type="text" class="form-control" name="company_name_1"  />
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <div class="form-group">
            <label for="company_address_1">Company Address:</label>
            <input type="text" class="form-control" name="company_address_1"  />
          </div>
        </div>


        <!-- Left Column (Patient Details) -->
        <div class="col-md-4 mb-3">
          <div class="form-group">
            <label for="quantity_1">Quantity:</label>
            <input type="number" class="form-control" name="quantity_1" required />
          </div>
        </div>

    </div>
  </div>
    <input type="hidden" id="productCount" name="product_count" value="1" />

    <!-- <div class="text-center mt-3">
      <button type="button" class="btn btn-primary" id="addProductField">Add Product</button>
    </div> -->

    <button type="submit" class="btn btn-primary">Save</button>
  </form>
</div>

<!-- End of Main Content -->
{% endblock %} {% block script %}
<script></script>
<script>
  $(document).ready(function () {
    $("#department").change(function () {
      var departmentId = $(this).val();
      $.ajax({
        url: '{% url "get_doctors_by_department" %}',
        type: "GET",
        data: {
          department_id: departmentId,
        },
        success: function (data) {
          console.log(data);
          $("#doctor").empty();
          $.each(data.doctors, function (index, doctor) {
            $("#doctor").append('<option value="' + doctor.doctor_id + '">' + doctor.name + "</option>");
          });
        },
      });
    });
  });
</script>

<script>

$("#orderForm").on("keydown", function (event) {

if (event.keyCode === 13) { // Check if Enter key is pressed
    event.preventDefault(); // Prevent the default behavior of the Enter key

}
});

  // Function to add product fields dynamically
  // document.getElementById("addProductField").addEventListener("click", function () {
    $("#productFields").on("keyup", "input[name^='quantity']", function (event) {
    if (event.keyCode === 13) { // Check if Enter key is pressed
      event.preventDefault();
    var productCount = parseInt($("#productCount").val());
    productCount++;
    $("#productCount").val(productCount);
    var productFields = document.getElementById("productFields");
    var productRow = document.createElement("div");
    productRow.className = "row product-row";

    var middleColumn = document.createElement("div");


    var productColumn = document.createElement("div");
    productColumn.className = "col-md-4 mb-3";
    productColumn.innerHTML = `
          <div class="form-group">
            <label for="product_name_${productCount}">Product Name:</label>
            <input type="text" class="form-control" name="product_name_${productCount}"  />
          </div>
        `;


    var mfgColumn = document.createElement("div");
    mfgColumn.className = "col-md-4 mb-3";
    mfgColumn.innerHTML = `
          <div class="form-group">
            <label for="company_name_${productCount}">Company Name:</label>
            <input type="text" class="form-control" name="company_name_${productCount}"  />
          </div>
        `;



    var quantityColumn = document.createElement("div");
    quantityColumn.className = "col-md-3 mb-3";
    quantityColumn.innerHTML = `
        <div class="form-group">
          <label for="quantity">Quantity:</label>
          <input type="number" class="form-control" name="quantity_${productCount}" required />
        </div>
      `;



    var removeButton = document.createElement("div");
    removeButton.className = "col-md-1 cross_div";
    removeButton.innerHTML = `
      <div class="form-group">
          <label for="">&nbsp;</label>
          <button type="button" class="btn btn-danger remove-product">x</button>
      </div>
    `;

    productRow.appendChild(productColumn);
    productRow.appendChild(mfgColumn);
    productRow.appendChild(quantityColumn);
    productRow.appendChild(removeButton);

    productFields.appendChild(productRow);
      }
  });

  // Function to remove product fields
  document.addEventListener("click", function (event) {
    if (event.target.classList.contains("remove-product")) {
      var productCount = parseInt($("#productCount").val());
      productCount--;
      $("#productCount").val(productCount);
      event.target.closest(".product-row").remove();
    }
  });
</script>

<script>
  $(document).ready(function () {
    // Event delegation for product type select elements
    $("#productFields").on("change", "select[name^='product_type']", function () {
      var productType = $(this).val();
      var container = $(this).closest(".product-row");
      var productNameSelect = container.find("select[name^='product_name']");

      $.ajax({
        url: '{% url "get_product_names_by_type" %}',
        type: "GET",
        data: {
          product_type: productType,
        },
        success: function (data) {
          productNameSelect.empty();
          $.each(data.products, function (index, product) {
            productNameSelect.append('<option value="' + product.product_type_id + '">' + product.name + "</option>");
          });
        },
      });
    });
  });
</script>
{% endblock %}
