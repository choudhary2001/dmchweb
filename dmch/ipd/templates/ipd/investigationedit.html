{% extends 'counter/base.html' %} {% block css %} {% endblock %} {% block content %}
<!-- Begin Page Content -->
<style>
  label {
    width: 230px;
  }
  .form-group {
    margin-bottom: 0.2rem;
    line-height: 0.5rem;
    align-items: center;
  }
  .form-control {
    padding: ".15rem .75rem";
  }
</style>
<div class="container-fluid">
  <!-- Page Heading -->
  <form id="patientForm" method="POST" action="/ipd/update-patient/{{patient.patient_dmission_id}}/">
    {% csrf_token %}



    <div class="row">

    
      <div class="col-md-4 mb-3">
        <label for="regid">Reg No.:</label>
        <input type="text" class="form-control" id="regid" name="regid" value="{{patient.regno}}" required  />

    </div>



    <div class="col-md-4 mb-3">
        <label for="name">Patient Name :</label>
        <input type="tel" class="form-control" id="name" name="name" value="{{patient.name}}" required  />
    </div>

    <div class="col-md-4 mb-3">
      <label for="age">Gender :</label>
      <select type="text" id="gender" class="form-control" name="gender" required style=""  >
        <option value="Male" {% if patient.gender == 'Male' %} selected {% endif %}>Male</option>
        <option value="Female" {% if patient.gender == 'Female' %} selected {% endif %}>Female</option>
        <option value="Other" {% if patient.gender == 'Other' %} selected {% endif %}>Other</option>
        <option value="Prefer not to say" {% if patient.gender == 'Prefer not to say' %} selected {% endif %}>Prefer not to say</option>
        <option value="Non-binary" {% if patient.gender == 'Non-binary' %} selected {% endif %}>Non-binary</option>
        <option value="Transgender" {% if patient.gender == 'Transgender' %} selected {% endif %}>Transgender</option>
        <option value="Genderqueer" {% if patient.gender == 'Genderqueer' %} selected {% endif %}>Genderqueer</option>
        <option value="Agender" {% if patient.gender == 'Agender' %} selected {% endif %}>Agender</option>
      </select>
      
    </div>

    <div class="col-md-4 mb-3">
        <label for="age">Age:</label>
        <div style="display: flex;" >
          <input type="number" class="form-control" id="year" name="year" style="width: 33%" placeholder="Year" value="{{patient.year}}"   /> &nbsp; <input type="number" class="form-control" id="month" name="month" style="width: 33%" placeholder="Month" value="{{patient.month}}"   /> &nbsp;
          <input type="number" class="form-control" id="days" name="days" style="width: 33%" placeholder="Days" value="{{patient.days}}"  />
        </div>
    </div>

    <div class="col-md-8 mb-3">
      <label for="guardianname">Guardian's Name :</label>
      <div style="display: flex; width: 100%">
        <select class="form-control" id="guardiannametitle" name="guardiannametitle" style="width: 25%" required   >
            <option value="Self" {% if patient.guardiannametitle == 'Self' %} selected {% endif %}>Self</option>
            <option value="S/O" {% if patient.guardiannametitle == 'S/O' %} selected {% endif %}>S/O (Son of)</option>
            <option value="D/O" {% if patient.guardiannametitle == 'D/O' %} selected {% endif %}>D/O (Daughter of)</option>
            <option value="W/O" {% if patient.guardiannametitle == 'W/O' %} selected {% endif %}>W/O (Wife of)</option>
            <option value="H/O" {% if patient.guardiannametitle == 'H/O' %} selected {% endif %}>H/O (Husband of)</option>
            <option value="F/O" {% if patient.guardiannametitle == 'F/O' %} selected {% endif %}>F/O (Father of)</option>
            <option value="M/O" {% if patient.guardiannametitle == 'M/O' %} selected {% endif %}>M/O (Mother of)</option>
            <option value="G/O" {% if patient.guardiannametitle == 'G/O' %} selected {% endif %}>G/O (Guardian of)</option>
          </select>
          
        &nbsp; &nbsp;
        <input type="text" class="form-control" id="guardianname" name="guardianname" style="width: 74%" value="{{patient.guardianname}}" required    />
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <label for="mobile">Mobile No. :</label>
      <input type="text" class="form-control" id="mobile" value="{{patient.mobno}}" name="mobile"   />

    </div>

    <div class="col-md-4 mb-3">
      <label for="address">Address :</label>
      <input type="text" class="form-control" id="address" required name="address" value="{{patient.address}}"  />

    </div>

    <div class="col-md-4 mb-3">
      <label for="policest">Police Station :</label>
      <input type="text" class="form-control" id="policest" required name="policest" value="{{patient.policest}}"   />

    </div>

    <div class="col-md-4 mb-3">
      <label for="district">District :</label>
      <input type="text" class="form-control" id="district" name="district" value="{{patient.district}}"   />

    </div>

    <!-- <div class="col-md-4 mb-3">
      <label for="state">State :</label>
      <input type="text" class="form-control" id="state" name="state" />
    </div> -->

    <div class="col-md-4 mb-3">
      <label for="pincode">Pin Code :</label>
      <input type="text" class="form-control" id="pincode" name="pincode" value="{{patient.pincode}}"   />

    </div>

    <div class="col-md-4 mb-3">
      <label for="department">Departments :</label>

      <select type="text" id="department" class="form-control" name="department" value="{{patient.department.department_id}}" required style=""  >
        <option>Select Department</option>
        {% for d in departments %}
          <option value="{{d.department_id}}" {% if patient.department.department_id == d.department_id %} selected {% endif %}>{{d.name}}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-4 mb-3">
      <label for="doctor">Doctors :</label>
      <select type="text" id="doctor" class="form-control" name="doctor"  style="" value="{{patient.doctor.doctor_id}}"  >
        <option>Select Doctor</option>
      </select>

    </div>


    <div class="col-md-4 mb-3">
      <label for="disease">Disease :</label>
      <input type="text" class="form-control" id="disease" value="{{patient.disease}}" name="disease"  />
    </div>



    <div class="col-md-4 mb-3">
      <label for="admit_date">Admit Date :</label>
      <input type="datetime-local" class="form-control" id="admit_date" value="{{patient.appointment_date|date:'Y-m-d\\TH:i'}}" name="admit_date"  />
    </div>

    <div class="col-md-4 mb-3">
      <label for="death">Death :</label>
      <select class="form-control" id="death" name="death"  >
        <option value="">Select</option>
        <option {% if patient.death == 'Yes' %}selected{% endif %} value="Yes">Yes</option>
        <option  {% if patient.death == 'No' %}selected{% endif %} value="No">No</option>
      </select>
    </div>

    <div class="col-md-4 mb-3">
      <label for="lama">Lama :</label>
      <select class="form-control" id="lama" name="lama"  >
        <option value="">Select</option>
        <option {% if patient.lama == 'Yes' %}selected{% endif %} value="Yes">Yes</option>
        <option  {% if patient.lama == 'No' %}selected{% endif %} value="No">No</option>
      </select>
        
    </div>

    <div class="col-md-4 mb-3">
        <label for="admit_date">Discharge Date :</label>
        <input type="datetime-local" class="form-control" id="discharge_date" value="{{patient.discharge_date|date:'Y-m-d\\TH:i'}}" name="discharge_date" />
    </div>


    <div class="col-md-12 mb-3">

      <button type="submit" class="btn btn-primary">Save</button>
    </div>
  </form>
</div>

<!-- End of Main Content -->
{% endblock %} {% block script %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("regid").focus();
  });
</script>
<script>
  $(document).ready(function () {
    // $("#department").change(function () {
      var departmentId = $("#department").val();
      $.ajax({
        url: '{% url "get_ipd_doctors_by_department" %}',
        type: "GET",
        data: {
          department_id: departmentId,
        },
        success: function (data) {
          console.log(data);
          $("#doctor").empty();
          $.each(data.doctors, function (index, doctor) {
            $("#doctor").append('<option value="' + doctor.doctor_id + '">' + doctor.name + "</option>");
          });
        },
      });
    // });
  });



</script>

<script>
  $(document).ready(function () {
    $("#regid").on("input", function () {
      var regid = $(this).val();
      if (regid) {
        $.ajax({
          url: '{% url "fetch_ipd_decharge_patient_data" %}',
          type: "GET",
          data: {
            regid: regid,
          },
          success: function (d) {
            console.log(d)
            data = d.patient;
            var date = new Date(data.appointment_date);
            var formattedDate = date.toISOString().slice(0, 16);
            // Update input fields with fetched data
            $("#name").val(data.name);
            $("#guardiannametitle").val(data.guardiannametitle);
            $("#guardianname").val(data.guardianname);
            $("#gender").val(data.gender);
            $("#year").val(data.year);
            $("#month").val(data.month);
            $("#days").val(data.days);
            $("#mobile").val(data.mobno);
            $("#address").val(data.address);
            $("#district").val(data.district);
            $("#policest").val(data.policest);
            $("#state").val(data.state);
            $("#pincode").val(data.pincode);
            $("#department").val(d.department);
            $("#doctor").val(d.doctor);
            $("#disease").val(data.disease);
            $("#admit_date").val(formattedDate);
          },
          error: function (xhr, status, error) {
            console.error(xhr.responseText);
            // Handle error if necessary
            $("#name").val('');
            $("#gender").val('');
            $("#age").val('');
            $("#mob_no").val('');
          },
        });
      } else {
        // Clear input fields when regid is empty
        $("#name").val('');
        $("#gender").val('');
        $("#age").val('');
        $("#mob_no").val('');
      }
    });
  });
</script>




<script>
  // Function to handle form submission
  function handleFormSubmission(event) {
    event.preventDefault(); // Prevent default form submission

    // Your additional logic for form validation or processing goes here

    // Select all input fields in the form
    const inputs = document.querySelectorAll("#patientForm input, #patientForm select, #patientForm textarea");

    // Flag to keep track of form validity
    let isValid = true;

    // Loop through each input field
    inputs.forEach(function (input) {
      // Check if the input field is required and does not have a value
      if (input.hasAttribute("required") && !input.value.trim()) {
        // If a required field is empty, set isValid to false
        isValid = false;
        // Highlight the empty field (you can customize this part)
        input.style.border = "1px solid red";
      } else {
        // Remove any previous highlighting
        input.style.border = "";
      }
    });

    // If the form is valid, submit it
    if (isValid) {
      document.getElementById("patientForm").submit();
    } else {
      // If the form is invalid, display an alert (you can customize this part)
      //   alert("Please fill out all required fields.");
    }
  }

  // Function to handle keyboard shortcuts
  function handleShortcut(event) {
    // if (event.ctrlKey && event.key === "s") {
    if (event.key === "F2") {
      // Ctrl + S pressed, trigger form submission
      event.preventDefault();
      handleFormSubmission(event);
    }
  }

  // Attach event listener for form submission
  document.getElementById("patientForm").addEventListener("submit", handleFormSubmission);

  // Attach event listener for keyboard shortcuts
  document.addEventListener("keydown", handleShortcut);
</script>
{% endblock %}
